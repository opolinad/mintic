<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../static/content/interface.css">
    <link href="../static/content/main.css" rel="stylesheet">
    <link href="../static/content/test2.css" rel="stylesheet">

    <!-- Llamado de fuente google fonts -->
    <!-- Montserrat 700 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="../static/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="../static/assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="../static/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="../static/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">


</head>

<body class="d-flex flex-column min-vh-100">


    <section id="topbar" class="topbar d-flex align-items-center">
        <div class="container d-flex justify-content-center justify-content-md-between">
            <div class="contact-info d-flex align-items-center">
                <i id="iconomaps" class="bi bi-pin-map d-flex align-items-center">Carrera 14L # 68B 20 sur, Bogotá
                    Colombia</a></i>
                <i id="iconoemail" class="bi bi-envelope d-flex align-items-center">contacto@colegiojab.edu.co<a
                        href="https://www.google.com/maps/place/Colegio+psicopedagogico+monse%C3%B1or+jaime+Alberto+bonilla+nieto/@4.6129979,-74.1334901,17z/data=!3m1!4b1!4m5!3m4!1s0x8e3f9f1b089ae055:0xcf3ee8103acec297!8m2!3d4.6129831!4d-74.1290166"></a></i>
            </div>
            <div class="social-links d-none d-md-flex align-items-center">
                <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
                <a href="https://www.facebook.com/colegiojaimebonilla" class="facebook"><i
                        class="bi bi-facebook"></i></a>
                <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
                <a href="#" class="youtube"><i class="bi bi-youtube"></i></i></a>
            </div>
        </div>
    </section>


    <nav class="navbar bg-light">
        <div class="container">
            <a id="logo_head" class="navbar-brand" href="#">
                <img src="../static/images/logocolegio.png" alt="Bootstrap" width="400">
            </a>
        </div>
    </nav>


    <div class="container mt-2">
        <ul class="nav nav-tabs nav-fill justify-content-center">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#home">
                    Consulta calificaciones <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"
                        fill="currentColor" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                        <path
                            d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
                    </svg> </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#profile">
                    Editar proyecto <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                        class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                        <path
                            d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
                    </svg>
                    </svg> </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#contact">
                    Matrícula estudiantes <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"
                        fill="currentColor" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                        <path
                            d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
                    </svg> </a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="home">
                <div class="row border g-0 rounded shadow-sm">
                    <div class="col p-4">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th class="centrado">Estudiante</th>
                                    <th class="centrado">Proyecto</th>
                                    <th class="centrado">Calificación obtenida</th>
                                </tr>
                            </thead>

                            <tbody id="table-projects-grades">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-pane" id="profile">
                <div class="row border g-0 rounded shadow-sm">
                    <div class="mb-3 mt-3 row">
                        <div class="col-10">
                            <h3>Listado de proyectos</h3>
                        </div>
                        <div class="col-2 text-left">
                            <button id="button_enviar" class="mb-2 btn btn-secondary boton_formulario"
                                onclick="createProject()">Crear nuevo</button>
                        </div>

                    </div>

                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Nombre</th>
                                <th scope="col">Modificar</th>
                                <th scope="col">Eliminar</th>
                            </tr>
                        </thead>
                        <tbody id="table-projects">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-pane" id="contact">
                <div class="row border g-0 rounded shadow-sm">
                    <div class="col p-4">

                        <form method="post" action="http://localhost:8000/api/users" >
                            {% csrf_token %}
                            <h1>Datos personales</h1>
                            <div class="mb-3 col-sm-4 col-md-4 col-lg-4 col-xl-4 py-4 bg-white">
                                <input type="number" class="form-control" name="id"
                                    placeholder="Número de identificación" required>
                                <br>
                                <input type="text" class="form-control" name="nombre" placeholder="Nombres" required>
                                <br>
                                <input type="text" class="form-control" name="apellidos" placeholder="Apellidos" required>
                                <br>
                                <input type="text" class="form-control" name="clave" placeholder="Contraseña" required>
                                <br>
                                <input type="text" class="form-control" name="telefono" placeholder="Teléfono" required>
                                <br>
                                <input type="text" class="form-control" name="correo" placeholder="Correo" required>
                                <br>
                                <select class="form-control" name="genero" required>
                                    <option value="m">Masculino</option>
                                    <option value="f">Femenino</option>
                                    <option value="o">Otro</option>
                                </select>
                                <br>
                                <select name="idProyecto" id="projecId-select" class="form-control" required>
                                </select>
                                <input type="hidden" name="tipoIdentificado" value="cc">
                                <input type="hidden" name="tUsuario" value="estudiante">
                                <input type="hidden" name="estado" value="true">
                                <input type="hidden" name="notaDefinitivaProyecto" value="0.0">
                                <br>
                                <button id="button_enviar" class="mb-2 btn btn-secondary boton_formulario form-control">Crear estudiante</button>
                            </div>
                        </form>

                    </div>

                </div>
            </div>


        </div>

    </div>
    {% csrf_token %}
    <script>
        let usuarios = null;
        let proyectos = null;
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        fetch('http://localhost:8000/api/users')
            .then(response => response.json())
            .then(response => {
                usuarios = response.usuarios.filter(usuario => usuario.tUsuario === "estudiante");
                fetch('http://localhost:8000/api/projects')
                    .then(response => response.json())
                    .then(data => {
                        proyectos = data.proyectos;
                        usuarios.forEach(usuario => {
                            document.getElementById('table-projects-grades').innerHTML +=
                                `<tr>
                                    <td class="centrado">${usuario.nombre} ${usuario.apellidos}</td>
                                    <td class="centrado">${proyectos.filter(proyecto => proyecto.id === usuario.idProyecto_id)[0].nombre}</td>
                                    <td class="centrado">${usuario.notaDefinitivaProyecto} / 5.0</td>

                                </tr>`

                        });
                        proyectos.forEach(proyecto => {
                            document.getElementById('table-projects').innerHTML +=
                                `<tr>
                                    <th scope="row">${proyecto.id}</th>
                                    <td>${proyecto.nombre}</td>
                                    <td>
                                        <button id="button_enviar" class="mb-2 btn btn-secondary boton_formulario" onclick="modifyProject(${proyecto.id})">Modificar</button>
                                    </td>
                                    <td>
                                        <button id="button_enviar" class="mb-2 btn btn-secondary boton_formulario" onclick="deleteProject(${proyecto.id})">Eliminar</button>
                                    </td>
                                </tr>`
                            document.getElementById('projecId-select').innerHTML+=
                            `<option value="${proyecto.id}">${proyecto.nombre}</option>`
                        });
                    });
            });
        const modifyProject = id => {
            let newProjectName = prompt("¿Cuál es el nuevo nombre del proyecto?", proyectos.filter(proyecto => proyecto.id === id)[0].nombre);
            if (newProjectName) {
                let data = new FormData();
                data.append('nombre', newProjectName)
                data.append('estado', "activo")
                data.append('_method', "PUT")
                data = new URLSearchParams(data);
                return fetch('http://localhost:8000/api/projects/' + id, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': csrftoken
                    },
                    mode: "same-origin",
                    body: data
                })
                    .then(response => {
                        location.reload();
                    });
            }
        };
        const deleteProject = id => {
            let data = new FormData();
            data.append('_method', "DELETE")
            data = new URLSearchParams(data);
            return fetch('http://localhost:8000/api/projects/' + id, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrftoken
                },
                mode: "same-origin",
                body: data
            })
                .then(response => response.json())
                .then(response => response.msg === "Error" ?
                    alert("No se puede borrar el proyecto porque tiene estudiantes asociados") :
                    location.reload()
                );
        }
        const createProject = () => {
            let projectName = prompt("¿Cuál es el nombre del proyecto?");
            let data = new FormData();
            data.append('nombre', projectName)
            data.append('estado', "activo")
            data = new URLSearchParams(data);
            return fetch('http://localhost:8000/api/projects', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrftoken
                },
                mode: "same-origin",
                body: data
            })
                .then(response => location.reload());
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>


    <footer id="footer" class="mt-auto">
        <div class="container">
            <div class="row gy-4 ">
                <div class="col-lg-5 col-md-12 footer-info">
                    <img id="logo_cole_footer" src="../static/images/logocolegio.png" alt="logo_colegio" height=100em>
                    <p class="justify-content-center">La disciplina es el mejor camino para cumplir tus metas.
                    </p>

                </div>

                <div class="col-lg-2 col-6 footer-links">
                    <h4>Estudiantes</h4>
                    <ul>
                        <li><a id="footer_link" href="#">Consultar Calificaciones</a></li>
                        <li><a id="footer_link" href="#">Consultar histórico</a></li>
                        <li><a id="footer_link" href="#">Auto matrícula</a></li>
                    </ul>
                </div>

                <div class="col-lg-2 col-6 footer-links">
                    <h4>Docentes</h4>
                    <ul>
                        <li><a id="footer_link" href="#">Cargar calificaciones</a></li>
                        <li><a id="footer_link" href="#">Editar calificaciones</a></li>
                        <li><a id="footer_link" href="#">Borrar calificaciones</a></li>
                    </ul>
                </div>

                <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
                    <h4>Contacto</h4>
                    <p>
                        Carrera 14L #68B 20 sur <br>
                        Bogotá Colombia<br><br>
                        <strong>PBX:</strong> 601 555 5555<br>
                        <strong>Email:</strong> contacto@colegiojab.edu.co<br>
                    </p>

                </div>

            </div>
        </div>
    </footer>


    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>


</body>

</html>